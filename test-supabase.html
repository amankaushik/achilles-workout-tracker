<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Supabase Connection Test</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <h1>Supabase Connection Test</h1>
  <div id="output"></div>

  <script type="module">
    const supabaseUrl = 'https://yfnrkjszmlyzvsvowytt.supabase.co';
    const supabaseKey = 'sb_publishable_imTl-md9qRKI8W9oG1Zcyw_vwLHbWhQ';
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    const output = document.getElementById('output');

    async function runTests() {
      output.innerHTML = '<h2>Running tests...</h2>';

      try {
        // Test 1: Check if exercises table exists
        output.innerHTML += '<h3>Test 1: Checking exercises table...</h3>';
        const { data: exercises, error: exercisesError } = await supabase
          .from('exercises')
          .select('*')
          .limit(5);

        if (exercisesError) {
          output.innerHTML += `<p style="color: red;">❌ Exercises table error: ${exercisesError.message}</p>`;
          output.innerHTML += `<pre>${JSON.stringify(exercisesError, null, 2)}</pre>`;
        } else {
          output.innerHTML += `<p style="color: green;">✅ Exercises table exists. Found ${exercises.length} exercises</p>`;
          output.innerHTML += `<pre>${JSON.stringify(exercises, null, 2)}</pre>`;
        }

        // Test 2: Check if users table exists
        output.innerHTML += '<h3>Test 2: Checking users table...</h3>';
        const { data: users, error: usersError } = await supabase
          .from('users')
          .select('*')
          .limit(5);

        if (usersError) {
          output.innerHTML += `<p style="color: red;">❌ Users table error: ${usersError.message}</p>`;
          output.innerHTML += `<pre>${JSON.stringify(usersError, null, 2)}</pre>`;
        } else {
          output.innerHTML += `<p style="color: green;">✅ Users table exists. Found ${users?.length || 0} users</p>`;
        }

        // Test 3: Try to create temp user
        output.innerHTML += '<h3>Test 3: Creating temp user...</h3>';
        const tempUserId = '00000000-0000-0000-0000-000000000000';
        const { data: newUser, error: createError } = await supabase
          .from('users')
          .insert({
            id: tempUserId,
            email: 'temp@achilles.local',
            name: 'Temporary User',
          })
          .select()
          .single();

        if (createError) {
          if (createError.code === '23505') {
            output.innerHTML += `<p style="color: orange;">⚠️ Temp user already exists (this is OK)</p>`;
          } else {
            output.innerHTML += `<p style="color: red;">❌ Error creating temp user: ${createError.message}</p>`;
            output.innerHTML += `<pre>${JSON.stringify(createError, null, 2)}</pre>`;
          }
        } else {
          output.innerHTML += `<p style="color: green;">✅ Temp user created successfully</p>`;
        }

        // Test 4: Check workout_logs table
        output.innerHTML += '<h3>Test 4: Checking workout_logs table...</h3>';
        const { data: workouts, error: workoutsError } = await supabase
          .from('workout_logs')
          .select('*')
          .limit(5);

        if (workoutsError) {
          output.innerHTML += `<p style="color: red;">❌ Workout_logs table error: ${workoutsError.message}</p>`;
          output.innerHTML += `<pre>${JSON.stringify(workoutsError, null, 2)}</pre>`;
        } else {
          output.innerHTML += `<p style="color: green;">✅ Workout_logs table exists. Found ${workouts?.length || 0} workouts</p>`;
        }

        output.innerHTML += '<h2>Tests complete!</h2>';

      } catch (error) {
        output.innerHTML += `<p style="color: red;">❌ Unexpected error: ${error.message}</p>`;
        console.error('Test error:', error);
      }
    }

    runTests();
  </script>
</body>
</html>
